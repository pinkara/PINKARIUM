<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Module Interactif — Faddeev-LeVerrier (style A*)</title>
  <!-- Favicon -->
    <link rel="icon" href="https://pinkara.github.io/PINKARIUM/favicon/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" href="https://pinkara.github.io/PINKARIUM/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://pinkara.github.io/PINKARIUM/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://pinkara.github.io/PINKARIUM/favicon/favicon-48x48.png" sizes="48x48">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="icon" type="image/png" href="https://pinkara.github.io/PINKARIUM/favicon/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="https://pinkara.github.io/PINKARIUM/favicon/android-chrome-512x512.png" sizes="512x512">
    <link rel="apple-touch-icon" href="https://pinkara.github.io/PINKARIUM/favicon/apple-touch-icon.png">
    <link rel="mask-icon" href="https://pinkara.github.io/PINKARIUM/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="icon" href="https://pinkara.github.io/PINKARIUM/favicon/favicon.svg" type="image/svg+xml">
    <!-- Tailwind (Mise en page) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Police Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Police Code -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <!-- Prism CSS (Tokyo Night Custom) -->
  <style>
    /* Reset & Base */
    :root{
      --tn-bg: #1a1b26;
      --tn-bg-2: #0f1724;
      --tn-foreground: #a9b1d6;
      --tn-white: #c0caf5;
      --tn-blue: #7aa2f7;
      --tn-cyan: #7dcfff;
      --tn-green: #9ece6a;
      --tn-yellow: #e0af68;
      --tn-orange: #ff9e64;
      --tn-magenta: #bb9af7;
      --tn-comment: #565f89;
      --tn-border: #414868;
      --tn-storm: #24283b;
    }
    body { background: var(--tn-bg); color: var(--tn-foreground); font-family: 'Inter', sans-serif; margin: 0; }
    
    /* Layout */
    .container { max-width: 1280px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1fr 500px; gap: 20px; }
    @media (max-width: 1024px) { .container { grid-template-columns: 1fr; } }

    /* Cards */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(122,162,247,0.1);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    /* Boutons */
    .btn { background: var(--tn-blue); color: #000; padding: 8px 16px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
    .btn:hover { filter: brightness(1.1); }
    .btn.secondary { background: transparent; border: 1px solid var(--tn-border); color: var(--tn-white); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .input { background: var(--tn-bg-2); border: 1px solid var(--tn-border); color: var(--tn-white); padding: 8px; border-radius: 6px; width: 80px; text-align: center; }

    /* Code Block & Prism Overrides for Tokyo Night */
    pre[class*="language-"] {
      background: var(--tn-bg-2) !important;
      border: 1px solid var(--tn-border);
      border-radius: 8px;
      padding: 15px;
      margin: 0;
      font-family: 'JetBrains Mono', monospace !important;
      font-size: 0.9rem;
      line-height: 1.6;
      text-shadow: none !important;
    }
    code[class*="language-"], pre[class*="language-"] { color: var(--tn-foreground) !important; }
    
        /*  CLASS pour le pre code python  */
        .token.comment{color : #565f89}
        .token.punctuation{color:#7dcfff}
        .token.boolean{color:#7aa2f7}
        .token.function{color:#7dcfff}
        .token.number{color:#ff9e64}
        .token.class-name{color:#e0af68}
        .token.constant{color:#ff9e64}
        .token.property{color:#7dcfff}
        .token.symbol{color:#7dcfff}
        .token.builtin{color:#7dcfff}
        .token.keyword{color:#7aa2f7}
        .token.string{color:#9ece6a}
        .token.variable{color:#c0caf5}
        .token.decorator{color:#bb9af7}
        .token.parameter{color:#c0caf5}
        .token.type{color:#e0af68}
        .token.operator{color:#7dcfff};

    /* Interactive Tokens */
    .clickable {
      cursor: help;
      text-decoration: underline;
      text-decoration-style: dotted;
      text-decoration-color: rgba(122, 162, 247, 0.4);
      transition: all 0.2s;
    }
    .clickable:hover {
      background: rgba(122, 162, 247, 0.15);
      border-radius: 4px;
      color: var(--tn-white) !important;
    }

    /* Popover */
    .popover-panel {
      position: fixed;
      z-index: 10000;
      background: var(--tn-bg);
      border: 1px solid var(--tn-border);
      border-left: 3px solid var(--tn-blue);
      border-radius: 8px;
      padding: 12px 16px;
      width: 300px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      pointer-events: none;
      opacity: 0;
      transform: translateY(5px);
      transition: opacity 0.2s, transform 0.2s;
    }
    .popover-visible { opacity: 1; transform: translateY(0); }
    .popover-title { color: var(--tn-blue); font-weight: 700; margin-bottom: 4px; font-size: 0.95rem; }
    .popover-body { color: var(--tn-foreground); font-size: 0.85rem; line-height: 1.5; }

    /* Matrix Display */
    .matrix-box {
      font-family: 'JetBrains Mono', monospace;
      background: var(--tn-storm);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      color: var(--tn-white);
      margin-top: 10px;
    }
    
    /* Slides Utility */
    .slide { display: none; animation: fadeIn 0.4s ease; }
    .slide.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  </style>

  <!-- Prism JS Core & Python -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  
  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<div class="container">

  <!-- GAUCHE : Contenu Interactif -->
  <div>
    <div class="card mb-4">
      <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
        <div style="width:50px; height:50px; background:linear-gradient(135deg, var(--tn-blue), var(--tn-cyan)); border-radius:12px; display:flex; align-items:center; justify-content:center; color:#1a1b26; font-weight:800; font-size:1.2rem;">FL</div>
        <div>
          <h1 style="font-size:1.5rem; font-weight:700; color:var(--tn-white);">Faddeev-Le Verrier</h1>
          <div style="color:var(--tn-comment); font-size:0.9rem;">Module Interactif</div>
        </div>
      </div>
      
      <div style="display:flex; gap:10px; align-items:center; margin-bottom:20px;">
        <button id="btn-start" class="btn">▶ Démarrer</button>
        <button id="btn-reset" class="btn secondary">Réinitialiser</button>
        <div style="margin-left:auto; display:flex; gap:10px; align-items:center;">
          <span style="font-size:0.85rem; color:var(--tn-comment);">Mode:</span>
          <select id="mode-select" class="input" style="width:auto;">
            <option value="learn">Apprentissage</option>
            <option value="demo">Démonstration</option>
          </select>
        </div>
      </div>
      
      <!-- SLIDES -->
      <div id="slides-container">
        <!-- Slide 0 -->
        <div id="slide-0" class="slide active">
          <h2 style="color:var(--tn-cyan); font-weight:600; margin-bottom:10px;">Introduction</h2>
          <p>Bienvenue. Nous allons déconstruire l'algorithme de Faddeev-Le Verrier pour une matrice $A$.</p>
          <div class="matrix-box">
             $$ A = \begin{pmatrix} 3 & 1 \\ 2 & 4 \end{pmatrix} $$
          </div>
          <p style="margin-top:15px;">Cliquez sur <strong>Démarrer</strong> pour lancer le calcul pas à pas.</p>
        </div>

        <!-- Slide 1 -->
        <div id="slide-1" class="slide">
          <h2 style="color:var(--tn-blue); font-weight:600; margin-bottom:10px;">Étape 1 : Trace et M1</h2>
          <p>Le premier coefficient $c_1$ est simplement la trace de $A$.</p>
          <p>$$ c_1 = \text{tr}(A) $$</p>
          <div style="display:flex; gap:10px; align-items:center; margin-top:15px;">
            <label>c1 = </label>
            <input type="number" id="inp-c1" class="input" placeholder="?">
            <button id="check-c1" class="btn secondary">Vérifier</button>
            <span id="feedback-c1"></span>
          </div>
        </div>

        <!-- Slide 2 -->
        <div id="slide-2" class="slide">
          <h2 style="color:var(--tn-magenta); font-weight:600; margin-bottom:10px;">Étape 2 : Matrice Auxiliaire M2</h2>
          <p>On calcule la matrice auxiliaire suivante :</p>
          <p>$$ M_2 = A(M_1 - c_1 I) $$</p>
          <div id="m2-container" class="matrix-box" style="display:none; margin-bottom:15px;"></div>
          <p>Puis le coefficient $c_2$ :</p>
          <p>$$ c_2 = \frac{1}{2} \text{tr}(M_2) $$</p>
          <div style="display:flex; gap:10px; align-items:center; margin-top:15px;">
            <label>c2 = </label>
            <input type="number" id="inp-c2" class="input" placeholder="?">
            <button id="check-c2" class="btn secondary">Vérifier</button>
            <span id="feedback-c2"></span>
          </div>
        </div>

        <!-- Slide 3 -->
        <div id="slide-3" class="slide">
          <h2 style="color:var(--tn-green); font-weight:600; margin-bottom:10px;">Résultat Final</h2>
          <p>Le polynôme caractéristique est :</p>
          <div class="matrix-box" id="poly-res">
            $$ P(\lambda) = \lambda^2 - 7\lambda + 10 $$
          </div>
          <p style="margin-top:10px;">Les valeurs propres sont les racines de ce polynôme (2 et 5).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- DROITE : Code Python Interactif -->
  <div>
    <div class="card" style="position:sticky; top:20px;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h3 style="color:var(--tn-white); font-weight:600;">Code Python</h3>
        <span style="font-size:0.75rem; color:var(--tn-comment);">Survolez les mots-clés</span>
      </div>
      
      <!-- Code avec ID pour Prism -->
      <pre class="line-numbers"><code id="python-code" class="language-python">import numpy as np

def faddeev_le_verrier(A):
    """
    Calcule le polynôme caractéristique
    et l'inverse de A.
    """
    n = A.shape[0]
    I = np.eye(n)
    
    # Initialisation
    M = np.zeros((n, n))
    c = np.zeros(n + 1)
    
    # c_0 = 1 (coeff dominant)
    c[0] = 1
    B = np.zeros((n, n)) 

    for k in range(1, n + 1):
        # Étape matricielle
        if k == 1:
            M = A
        else:
            M = A @ (B + c[k-1] * I)
        
        B = M # Sauvegarde
        
        # Calcul du coeff via la Trace
        trace_val = np.trace(M)
        c[k] = - (1/k) * trace_val
        
    # Calcul de l'inverse
    invA = None
    if abs(c[n]) > 1e-10:
        invA = - (1/c[n]) * (M + c[n-1]*I)

    return c, invA
</code></pre>
      
      <div class="card" style="margin-top:15px; border:1px dashed var(--tn-comment); background:transparent;">
        <div style="display:flex; justify-content:space-between; font-size:0.85rem;">
          <span style="color:var(--tn-comment);">Status:</span>
          <span id="status-text" style="color:var(--tn-cyan);">Prêt</span>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- POPOVER (Caché par défaut) -->
<div id="popover" class="popover-panel">
  <div id="pop-title" class="popover-title">Titre</div>
  <div id="pop-desc" class="popover-body">Description...</div>
</div>

<script>
// ============================================
// 1. DICTIONNAIRE COMPLET (POPOVERS)
// ============================================
const definitions = {
  // Python Core
  'import': { title:'import', text:'Importe un module externe pour utiliser ses fonctions.' },
  'def': { title:'def', text:'Déclare une nouvelle fonction.' },
  'return': { title:'return', text:'Renvoie le résultat de la fonction et termine son exécution.' },
  'for': { title:'for', text:'Boucle qui itère sur une séquence (comme range ou une liste).' },
  'in': { title:'in', text:'Opérateur d\'appartenance ou d\'itération dans une boucle.' },
  'if': { title:'if', text:'Conditionnelle : exécute le bloc si la condition est vraie.' },
  'else': { title:'else', text:'Alternative : s\'exécute si le "if" précédent est faux.' },
  'range': { title:'range', text:'Génère une séquence de nombres entiers.' },
  'abs': { title:'abs', text:'Renvoie la valeur absolue (positive) d\'un nombre.' },
  'print': { title:'print', text:'Affiche des informations dans la console.' },
  'as' : { title:'as' , text: 'Créer un alias (nom raccourci) pour un module importé'},
  
  // NumPy (Algèbre Linéaire)
  'numpy': { title:'numpy', text:'Bibliothèque standard pour le calcul scientifique en Python.' },
  'np': { title:'np', text:'Alias conventionnel pour numpy.' },
  'array': { title:'np.array', text:'Crée un tableau multidimensionnel (vecteur/matrice).' },
  'zeros': { title:'np.zeros', text:'Crée une matrice remplie de zéros.' },
  'eye': { title:'np.eye', text:'Crée une matrice identité (1 sur la diagonale, 0 ailleurs).' },
  'shape': { title:'shape', text:'Attribut donnant les dimensions (lignes, colonnes) de la matrice.' },
  'trace': { title:'np.trace', text:'Somme des éléments diagonaux. Cœur de l\'algorithme de Faddeev.' },
  'dot': { title:'np.dot', text:'Produit matriciel (ou utiliser @ en Python récent).' },
  'inv': { title:'np.linalg.inv', text:'Calcule l\'inverse d\'une matrice.' },
  
  // Variables Spécifiques
  'faddeev_le_verrier': { title:'Algorithme', text:'Méthode récursive pour polynôme caractéristique et inverse.' },
  'A': { title:'Matrice A', text:'La matrice d\'entrée dont on cherche les propriétés.' },
  'M': { title:'Matrice M', text:'Matrice auxiliaire calculée à chaque étape k.' },
  'c': { title:'Vecteur c', text:'Stocke les coefficients du polynôme caractéristique.' },
  'I': { title:'Matrice I', text:'Matrice identité de même taille que A.' },
  'n': { title:'Dimension n', text:'La taille de la matrice carrée (n x n).' }
};

// ============================================
// 2. ENRICHISSEMENT PRISM + POPOVERS
// ============================================
window.addEventListener('load', () => {
  // ASTUCE PRO : On injecte nos clés définies directement dans la grammaire de Prism 
  // pour forcer leur détection, même si Prism les ignore par défaut (comme 'shape' ou 'A').
  
  const customKeys = Object.keys(definitions).map(k => k.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
  
  // On insère notre règle 'custom-highlight' AVANT les règles standards pour qu'elle soit prioritaire
  Prism.languages.python['custom-highlight'] = {
    pattern: new RegExp(`\\b(${customKeys})\\b`),
    alias: 'custom-highlight'
  };

  // Maintenant on lance la coloration
  Prism.highlightAll();
  
  // Une fois le HTML généré par Prism, on attache nos événements
  // Prism utilise requestAnimationFrame, donc on attend un tick ou on le fait immédiatement si synchrone
  setTimeout(attachPopovers, 100);
});

function attachPopovers() {
  const codeBlock = document.getElementById('python-code');
  
  // On cible TOUS les tokens générés par Prism, y compris notre 'custom-highlight'
  const tokens = codeBlock.querySelectorAll('.token');
  
  tokens.forEach(token => {
    const text = token.textContent.trim();
    let key = text;
    if (!definitions[key] && definitions[key.toLowerCase()]) key = key.toLowerCase();
    
    if (definitions[key]) {
      token.classList.add('clickable');
      token.dataset.key = key;
      
      token.addEventListener('mouseenter', showPopover);
      token.addEventListener('mousemove', movePopover);
      token.addEventListener('mouseleave', hidePopover);
    }
  });
}

// Logique Popover
const popover = document.getElementById('popover');
const popTitle = document.getElementById('pop-title');
const popDesc = document.getElementById('pop-desc');

function showPopover(e) {
  const key = e.target.dataset.key;
  const def = definitions[key];
  if(def) {
    popTitle.textContent = def.title;
    popDesc.textContent = def.text;
    popover.classList.add('popover-visible');
    movePopover(e);
  }
}

function movePopover(e) {
  const offset = 15;
  let left = e.clientX + offset;
  let top = e.clientY + offset;
  
  if (left + 300 > window.innerWidth) left = e.clientX - 310;
  if (top + 100 > window.innerHeight) top = e.clientY - 100;
  
  popover.style.left = left + 'px';
  popover.style.top = top + 'px';
}

function hidePopover() {
  popover.classList.remove('popover-visible');
}


// ============================================
// 3. LOGIQUE INTERACTIVE (SLIDES)
// ============================================
// Données de l'exercice (A = [[3,1], [2,4]])
// Trace = 7, Det = 10. Poly = x^2 - 7x + 10.
const data = {
  c1: 7,
  c2: 10,
  M2: [[10, 0], [0, 10]] // Approximatif pour l'affichage (M2 = det * I dans le cas 2x2 final)
};

// Navigation Slides
const slides = document.querySelectorAll('.slide');
function goToSlide(n) {
  slides.forEach(s => s.classList.remove('active'));
  const target = document.getElementById('slide-'+n);
  if(target) target.classList.add('active');
  document.getElementById('status-text').textContent = "Étape " + n + "/3";
}

// Handlers Boutons
document.getElementById('btn-start').onclick = () => goToSlide(1);
document.getElementById('btn-reset').onclick = () => {
  document.getElementById('inp-c1').value = "";
  document.getElementById('inp-c2').value = "";
  document.getElementById('feedback-c1').textContent = "";
  document.getElementById('feedback-c2').textContent = "";
  document.getElementById('m2-container').style.display = "none";
  goToSlide(0);
};

// Validation C1
document.getElementById('check-c1').onclick = () => {
  const val = parseFloat(document.getElementById('inp-c1').value);
  const fb = document.getElementById('feedback-c1');
  if(val === data.c1) {
    fb.innerHTML = "<span style='color:var(--tn-green)'>Correct ! (3+4=7)</span>";
    setTimeout(() => goToSlide(2), 1000);
  } else {
    fb.innerHTML = "<span style='color:var(--tn-red)'>Incorrect. Trace = 3+4</span>";
  }
};

// Validation C2
document.getElementById('check-c2').onclick = () => {
  const val = parseFloat(document.getElementById('inp-c2').value);
  const fb = document.getElementById('feedback-c2');
  // Afficher M2 d'abord si pas fait
  const m2cont = document.getElementById('m2-container');
  m2cont.style.display = "block";
  m2cont.innerHTML = "$$ M_2 = \\begin{pmatrix} 10 & 0 \\\\ 0 & 10 \\end{pmatrix} $$";
  MathJax.typesetPromise();
  
  if(val === 5) { // Erreur commune (trace/2)
     if(val === 10) {
        fb.innerHTML = "<span style='color:var(--tn-green)'>Correct ! (Trace(M2)/2 = 20/2 = 10)</span>";
        setTimeout(() => goToSlide(3), 1000);
     } else if (val === 20) {
        fb.innerHTML = "<span style='color:var(--tn-orange)'>Presque. N'oublie pas de diviser par k=2.</span>";
     } else {
        fb.innerHTML = "<span style='color:var(--tn-red)'>Incorrect. Trace(M2) / 2</span>";
     }
  } else if (val === 10) {
     fb.innerHTML = "<span style='color:var(--tn-green)'>Correct ! (20/2 = 10)</span>";
     setTimeout(() => goToSlide(3), 1000);
  } else {
     fb.innerHTML = "<span style='color:var(--tn-red)'>Incorrect. Regardez la matrice M2.</span>";
  }
};

// Mode Démo Automatique
document.getElementById('mode-select').onchange = (e) => {
  if(e.target.value === 'demo') {
    runDemo();
  }
};

function runDemo() {
  goToSlide(1);
  setTimeout(() => {
    document.getElementById('inp-c1').value = 7;
    document.getElementById('check-c1').click();
  }, 1000);
  setTimeout(() => {
    document.getElementById('inp-c2').value = 10;
    document.getElementById('check-c2').click();
  }, 3500);
}

</script>
</body>
</html>
